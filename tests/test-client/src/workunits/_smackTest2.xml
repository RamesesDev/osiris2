<?xml version="1.0" encoding="UTF-8"?>
<workunit>
    
    <invokers>
        <invoker folderid="/menu/smack" caption="Client 2" action="init"/>
    </invokers>
    
    <code>
        <![CDATA[
        
        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.messaging.*;
        import test.smack.*;
        import com.rameses.util.*;
        
                
        public class SmackTest1 {
            
            @Binding
            def binding;
            
            def output = new StringBuffer();
                      
            def con;
            
            void init() {
                def uname = MachineInfo.getInstance().getMacAddress();
                con = MessagingDelegate.getConnection(null, uname.hashCode()+"", "12345");
                con.open();
                con.addMessageListener( listener );
            }
            
            def listener =[
                onMessage: { m ->
                    messageList.append( m.getBody() + "\n" );
                    binding.refresh();
                }
            ] as MessageListener;
            
            @Close
            def close() {
                con.close();
            }

        }
        
        ]]>
    </code>
    
    <pages>
        <page template="test.smack.Page2"/>
    </pages>
</workunit>
